<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NFT Event Ticketing System</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.8.1/dist/ethers.umd.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f0f2f5;
      margin: 0;
      padding: 30px;
    }

    .container {
      max-width: 600px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    }

    h1 {
      text-align: center;
      color: #2d3748;
      margin-bottom: 10px;
    }

    .wallet-section {
      text-align: center;
      margin-bottom: 20px;
    }

    button {
      background-color: #4f46e5;
      color: white;
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #4338ca;
    }

    input {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
    }

    #walletAddress {
      margin-top: 12px;
      color: green;
      font-weight: bold;
      font-size: 14px;
    }

    hr {
      margin: 25px 0;
      border: none;
      border-top: 1px solid #eee;
    }

    h2 {
      margin-top: 10px;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>NFT Event Ticketing System</h1>

    <div class="wallet-section">
      <button onclick="connectWallet()">Connect Wallet</button>
      <div id="walletAddress">Not connected</div>
    </div>

    <hr>

    <h2>Create Event</h2>
    <input type="text" id="eventName" placeholder="Event Name" />
    <input type="number" id="ticketPrice" placeholder="Ticket Price (in MATIC)" />
    <input type="number" id="ticketCount" placeholder="Total Tickets" />
    <button onclick="createEvent()">Create Event</button>
  </div>

  <script>
    const contractAddress = "0xa5cc32E9B7AE855319b6D32Aa6B4FD9b179C71d8"; // üîÅ Replace with your deployed contract address

    const abi = [[
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "eventId",
				"type": "uint256"
			}
		],
		"name": "buyTicket",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "price",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "totalTickets",
				"type": "uint256"
			}
		],
		"name": "createEvent",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "eventId",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "price",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "totalTickets",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "owner",
				"type": "address"
			}
		],
		"name": "EventCreated",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "eventId",
				"type": "uint256"
			},
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "ticketId",
				"type": "uint256"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "buyer",
				"type": "address"
			}
		],
		"name": "TicketPurchased",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "eventId",
				"type": "uint256"
			}
		],
		"name": "withdraw",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "events",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "price",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "totalTickets",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "ticketsSold",
				"type": "uint256"
			},
			{
				"internalType": "address payable",
				"name": "owner",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "eventId",
				"type": "uint256"
			}
		],
		"name": "getEvent",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getNextEventId",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "tickets",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]
      {
        "inputs":[
          {"internalType":"string","name":"name","type":"string"},
          {"internalType":"uint256","name":"price","type":"uint256"},
          {"internalType":"uint256","name":"totalTickets","type":"uint256"}
        ],
        "name":"createEvent",
        "outputs":[],
        "stateMutability":"nonpayable",
        "type":"function"
      }
    ];

    let provider, signer, contract;

    async function connectWallet() {
      if (window.ethereum) {
        try {
          await window.ethereum.request({ method: 'eth_requestAccounts' });
          provider = new ethers.BrowserProvider(window.ethereum);
          signer = await provider.getSigner();
          const address = await signer.getAddress();
          document.getElementById("walletAddress").textContent = `Connected: ${address}`;
          contract = new ethers.Contract(contractAddress, abi, signer);
        } catch (err) {
          console.error(err);
          alert("‚ùå Wallet connection failed.");
        }
      } else {
        alert("ü¶ä MetaMask not detected. Please install it.");
      }
    }

    async function createEvent() {
      if (!contract) {
        alert("Please connect your wallet first.");
        return;
      }

      const name = document.getElementById("eventName").value;
      const price = document.getElementById("ticketPrice").value;
      const tickets = document.getElementById("ticketCount").value;

      if (!name || !price || !tickets) {
        alert("‚ùó Please fill in all fields.");
        return;
      }

      try {
        const tx = await contract.createEvent(name, ethers.parseEther(price), tickets);
        await tx.wait();
        alert("‚úÖ Event created successfully!");
      } catch (err) {
        console.error("Event creation failed:", err);
        alert("‚ùå Could not create event.");
      }
    }
  </script>
</body>
</html>
